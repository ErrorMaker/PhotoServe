package com.hypermine.habbo.cameraserve;

import com.google.gson.Gson;
import com.hypermine.habbo.cameraserve.json.Photo;
import com.hypermine.habbo.cameraserve.json.Sprite;

import javax.imageio.ImageIO;
import java.awt.*;
import java.awt.geom.AffineTransform;
import java.awt.image.*;
import java.io.File;
import java.util.Collections;
import java.util.Comparator;

/**
 * Created by Scott Stamp <scott@hypermine.com> on 3/21/2017.
 */
public class Server {
    public static void main(String[] args) throws Exception
    {
        //String json = "{ \"planes\" : [{\"color\":0,\"bottomAligned\":false,\"z\":1613.1416713066808,\"texCols\":[],\"cornerPoints\":[{\"x\":320,\"y\":320},{\"x\":0,\"y\":320},{\"x\":320,\"y\":0},{\"x\":0,\"y\":0}]},{\"color\":7369339,\"bottomAligned\":false,\"z\":1507.9623353066809,\"texCols\":[],\"cornerPoints\":[{\"x\":194,\"y\":239},{\"x\":-62,\"y\":111},{\"x\":196,\"y\":238},{\"x\":-60,\"y\":110}]},{\"color\":9869476,\"bottomAligned\":false,\"z\":1502.3337924480836,\"texCols\":[],\"cornerPoints\":[{\"x\":196,\"y\":355},{\"x\":194,\"y\":356},{\"x\":196,\"y\":238},{\"x\":194,\"y\":239}]},{\"color\":12369870,\"bottomAligned\":false,\"z\":1007.9417934866304,\"texCols\":[{\"assetNames\":[\"wall_texture_64_0_wall_white\"]}],\"cornerPoints\":[{\"x\":194,\"y\":354},{\"x\":-62,\"y\":226},{\"x\":194,\"y\":239},{\"x\":-62,\"y\":111}]},{\"color\":10066278,\"bottomAligned\":false,\"z\":1007.5657934869265,\"texCols\":[{\"assetNames\":[\"floor_texture_64_0_floor_basic\"]}],\"cornerPoints\":[{\"x\":-222,\"y\":562},{\"x\":-478,\"y\":434},{\"x\":194,\"y\":354},{\"x\":-62,\"y\":226}]}],\"sprites\" : [{\"x\":-39,\"name\":\"hween09_floor_64_a_0_0\",\"z\":35.08976477206202,\"color\":16777215,\"y\":255},{\"x\":-127,\"name\":\"hween09_floor_64_b_0_3\",\"z\":35.01828545528311,\"color\":16777215,\"y\":223},{\"x\":1,\"name\":\"hween09_floor_64_a_0_1\",\"z\":33.675612736942995,\"color\":16777215,\"y\":287},{\"x\":-63,\"name\":\"hween09_floor_64_b_0_0\",\"z\":33.60413342482609,\"color\":16777215,\"y\":255},{\"x\":65,\"name\":\"hween09_floor_64_a_0_1\",\"z\":32.26146069875296,\"color\":16777215,\"y\":319},{\"x\":1,\"name\":\"hween09_floor_64_b_0_1\",\"z\":32.18998138970706,\"color\":16777215,\"y\":288},{\"x\":-127,\"name\":\"hween09_floor_64_b_0_0\",\"z\":32.189966027043056,\"color\":16777215,\"y\":287},{\"x\":-63,\"name\":\"hween09_floor_64_b_0_3\",\"z\":30.775813998510024,\"color\":16777215,\"y\":319},{\"x\":97,\"color\":16777215,\"y\":67,\"flipH\":true,\"name\":\"cubie_decal_1_b_64_a_2_0\",\"z\":15.164343094967439},{\"x\":-22,\"color\":16777215,\"y\":14,\"flipH\":true,\"name\":\"poster501_64_a_2_0\",\"z\":15.164220038313315},{\"x\":98,\"color\":16777215,\"y\":68,\"flipH\":true,\"name\":\"cubie_decal_1_b_64_b_2_0\",\"z\":12.335208863477062},{\"x\":48,\"color\":16777215,\"y\":40,\"flipH\":true,\"name\":\"pixel_walldeco_64_a_2_0\",\"z\":12.335186455299395},{\"x\":165,\"name\":\"poster9_64_a_4_0\",\"z\":10.921763938136218,\"color\":16777215,\"y\":105},{\"x\":-62,\"name\":\"attic15_wall_64_a_4_0\",\"z\":9.271516209561117,\"color\":16777215,\"y\":111},{\"x\":8,\"name\":\"attic15_wall_64_a_4_0\",\"z\":7.724787422785769,\"color\":16777215,\"y\":146},{\"x\":-4,\"color\":16777215,\"y\":159,\"flipH\":true,\"name\":\"poster501_64_a_2_0\",\"z\":7.690302789383893},{\"x\":0,\"color\":16777215,\"y\":145,\"flipH\":true,\"name\":\"poster27_64_a_2_0\",\"z\":7.484646465580049},{\"x\":55,\"name\":\"attic15_wall_64_a_4_0\",\"z\":6.68638085421843,\"color\":16777215,\"y\":170},{\"x\":40,\"name\":\"poster2_64_a_4_0\",\"z\":6.608594617774836,\"color\":16777215,\"y\":189},{\"x\":52,\"color\":16777215,\"y\":171,\"flipH\":true,\"name\":\"poster27_64_a_2_0\",\"z\":6.335647938990647},{\"x\":-96,\"name\":\"attic15_carpet_64_a_4_0\",\"z\":6.027699142724448,\"color\":16777215,\"y\":271},{\"x\":-19,\"color\":16777215,\"y\":264,\"name\":\"hc_arab_teamk_64_sd_4_0\",\"z\":6.027676065405918,\"alpha\":48},{\"x\":-74,\"color\":16777215,\"y\":204,\"flipH\":true,\"name\":\"xmas11_luxchair2_64_a_2_0\",\"z\":6.027645301612387},{\"x\":-21,\"color\":16777215,\"y\":198,\"name\":\"ads_pib_64_sd_4_0\",\"z\":6.011359389702032,\"alpha\":48},{\"x\":-35,\"color\":16777215,\"y\":218,\"flipH\":true,\"name\":\"xmas11_luxchair2_64_b_2_0\",\"z\":5.531963448037617},{\"x\":16,\"color\":16777215,\"y\":282,\"flipH\":true,\"name\":\"bonusrare16_7_64_sd_0_0\",\"z\":5.320600043276903,\"alpha\":48},{\"x\":-29,\"name\":\"hc_arab_teamk_64_a_4_0\",\"z\":5.32056928418237,\"color\":16777215,\"y\":169},{\"x\":117,\"name\":\"attic15_wall_64_a_4_0\",\"z\":5.316421071772836,\"color\":16777215,\"y\":201},{\"x\":-21,\"name\":\"ads_pib_64_a_4_0\",\"z\":5.304252608441485,\"color\":16777215,\"y\":165},{\"x\":-47,\"color\":16777215,\"blendMode\":\"add\",\"y\":131,\"name\":\"ads_pib_64_b_4_0\",\"z\":5.303545501697298},{\"x\":109,\"color\":16777215,\"y\":200,\"flipH\":true,\"name\":\"poster27_64_a_2_0\",\"z\":5.0762801149741135},{\"x\":19,\"color\":13012832,\"y\":268,\"flipH\":true,\"name\":\"bonusrare16_7_64_b_0_0\",\"z\":4.612786155235168},{\"x\":16,\"color\":16777215,\"y\":251,\"flipH\":true,\"name\":\"bonusrare16_7_64_c_0_0\",\"z\":4.612079048490982},{\"x\":18,\"color\":2461646,\"y\":230,\"flipH\":true,\"name\":\"bonusrare16_7_64_a_0_0\",\"z\":4.5427825838607},{\"x\":140,\"color\":16777215,\"y\":232,\"flipH\":true,\"name\":\"poster516_64_a_2_0\",\"z\":4.50868337515125},{\"x\":137,\"color\":16777215,\"y\":214,\"flipH\":true,\"name\":\"poster27_64_a_2_0\",\"z\":4.457588600448975},{\"x\":82,\"color\":16777215,\"y\":202,\"flipH\":true,\"name\":\"xmas11_hd1_64_a_2_0\",\"z\":4.241687043545114},{\"x\":186,\"color\":16777215,\"y\":307,\"flipH\":true,\"name\":\"dimmer_buttn_64_b_2_0\",\"z\":4.007892546786473,\"alpha\":51},{\"x\":183,\"color\":16777215,\"y\":308,\"flipH\":true,\"name\":\"dimmer_buttn_64_a_2_1\",\"z\":4.005064119624727},{\"x\":22,\"color\":16777215,\"y\":252,\"flipH\":true,\"name\":\"xmas11_luxsofa2_64_a_2_0\",\"z\":3.906417251579338},{\"x\":145,\"name\":\"post_it_64_a_4_0\",\"z\":3.7653847945359855,\"color\":16751871,\"y\":286},{\"x\":62,\"color\":16777215,\"y\":270,\"flipH\":true,\"name\":\"xmas11_luxsofa2_64_b_2_0\",\"z\":3.198603363648604},{\"x\":91,\"color\":16777215,\"y\":287,\"flipH\":true,\"name\":\"xmas11_luxsofa2_64_c_2_0\",\"z\":3.0564749006671077},{\"x\":103,\"name\":\"hc_dsk_64_a_0_0\",\"z\":2.4922652139813053,\"color\":16777215,\"y\":280},{\"x\":98,\"name\":\"hc_dsk_64_c_0_1\",\"z\":2.4901438937117457,\"color\":16777215,\"y\":260},{\"x\":131,\"color\":16777215,\"y\":280,\"flipH\":true,\"name\":\"throne_64_a_2_0\",\"z\":1.7851891965142896},{\"x\":68,\"name\":\"hc_dsk_64_b_0_0\",\"z\":1.7844513260505714,\"color\":16777215,\"y\":288},{\"x\":62,\"name\":\"hc_dsk_64_d_0_1\",\"z\":1.7823300057810116,\"color\":16777215,\"y\":293},{\"x\":76,\"color\":16777215,\"blendMode\":\"add\",\"y\":269,\"name\":\"hc_dsk_64_e_0_1\",\"z\":1.7809157922556385},{\"x\":39,\"name\":\"hween13_rose_64_a_0_0\",\"z\":1.0780978199722728,\"color\":16777215,\"y\":289},{\"x\":61,\"name\":\"hween13_rose_64_b_0_0\",\"z\":1.0773907132280862,\"color\":16777215,\"y\":295},{\"x\":54,\"name\":\"hween13_rose_64_c_0_0\",\"z\":1.0766836064838996,\"color\":16777215,\"y\":280},{\"x\":52,\"color\":16777215,\"blendMode\":\"add\",\"y\":281,\"name\":\"hween13_rose_64_d_0_0\",\"z\":1.075976499739713},{\"x\":-18,\"name\":\"penguin_musketeer_64_a_4_0\",\"z\":-0.34312350620254906,\"color\":16777215,\"y\":302}],\"modifiers\" : {},\"filters\" : [],\"roomid\" : 74080747,\"status\" : 19,\"timestamp\" : 1490146907668,\"checksum\" : 11349 }";
        String json = "{ \"planes\" : [{\"color\":0,\"bottomAligned\":false,\"z\":2774.3736893708888,\"texCols\":[],\"cornerPoints\":[{\"x\":320,\"y\":320},{\"x\":0,\"y\":320},{\"x\":320,\"y\":0},{\"x\":0,\"y\":0}]},{\"color\":10066278,\"bottomAligned\":false,\"z\":2419.6092673708886,\"texCols\":[{\"assetNames\":[\"floor_texture_64_0_floor_basic\"]}],\"cornerPoints\":[{\"x\":81,\"y\":208},{\"x\":49,\"y\":192},{\"x\":113,\"y\":192},{\"x\":81,\"y\":176}]},{\"color\":7369339,\"bottomAligned\":false,\"z\":1508.0275277979483,\"texCols\":[],\"cornerPoints\":[{\"x\":241,\"y\":13},{\"x\":239,\"y\":12},{\"x\":243,\"y\":12},{\"x\":241,\"y\":11}]},{\"color\":7369339,\"bottomAligned\":false,\"z\":1507.980335306829,\"texCols\":[],\"cornerPoints\":[{\"x\":-175,\"y\":221},{\"x\":-177,\"y\":220},{\"x\":241,\"y\":13},{\"x\":239,\"y\":12}]},{\"color\":7369339,\"bottomAligned\":false,\"z\":1507.9623353066809,\"texCols\":[],\"cornerPoints\":[{\"x\":497,\"y\":141},{\"x\":241,\"y\":13},{\"x\":499,\"y\":140},{\"x\":243,\"y\":12}]},{\"masks\":[{\"flipH\":false,\"location\":{\"x\":256,\"y\":29},\"name\":\"door_64\",\"flipV\":false}],\"color\":6923455,\"bottomAligned\":false,\"z\":1007.9807934867785,\"texCols\":[],\"cornerPoints\":[{\"x\":241,\"y\":128},{\"x\":-175,\"y\":336},{\"x\":241,\"y\":13},{\"x\":-175,\"y\":221}]},{\"masks\":[{\"flipH\":false,\"location\":{\"x\":256,\"y\":29},\"name\":\"door_64\",\"flipV\":false}],\"color\":9869476,\"bottomAligned\":false,\"z\":1007.9597934867414,\"texCols\":[{\"assetNames\":[\"wall_texture_64_0_wall_white\"]}],\"cornerPoints\":[{\"x\":241,\"y\":128},{\"x\":-175,\"y\":336},{\"x\":241,\"y\":13},{\"x\":-175,\"y\":221}]},{\"color\":12369870,\"bottomAligned\":false,\"z\":1007.9417934866304,\"texCols\":[{\"assetNames\":[\"wall_texture_64_0_wall_white\"]}],\"cornerPoints\":[{\"x\":497,\"y\":256},{\"x\":241,\"y\":128},{\"x\":497,\"y\":141},{\"x\":241,\"y\":13}]},{\"color\":10066278,\"bottomAligned\":false,\"z\":1007.5657934869265,\"texCols\":[{\"assetNames\":[\"floor_texture_64_0_floor_basic\"]}],\"cornerPoints\":[{\"x\":81,\"y\":464},{\"x\":-175,\"y\":336},{\"x\":497,\"y\":256},{\"x\":241,\"y\":128}]},{\"color\":7368778,\"bottomAligned\":false,\"z\":1002.4125999573342,\"texCols\":[{\"assetNames\":[\"floor_texture_64_0_floor_basic\"]}],\"cornerPoints\":[{\"x\":497,\"y\":258},{\"x\":81,\"y\":466},{\"x\":497,\"y\":256},{\"x\":81,\"y\":464}]}],\"sprites\" : [{\"x\":50,\"name\":\"bb_rnd_tele_64_a_0_0\",\"z\":1418.7731951967148,\"color\":16777215,\"y\":172},{\"x\":79,\"color\":16777215,\"blendMode\":\"add\",\"y\":172,\"name\":\"bb_rnd_tele_64_b_0_0\",\"z\":1418.3015549737004},{\"x\":200,\"name\":\"hween09_floor_64_a_0_3\",\"z\":36.50391680251906,\"color\":16777215,\"y\":126},{\"x\":264,\"name\":\"hween09_floor_64_a_0_0\",\"z\":35.08976477206202,\"color\":16777215,\"y\":157},{\"x\":136,\"name\":\"hween09_floor_64_a_0_0\",\"z\":35.089749408214026,\"color\":16777215,\"y\":157},{\"x\":176,\"name\":\"hween09_floor_64_b_0_3\",\"z\":35.01828545528311,\"color\":16777215,\"y\":125},{\"x\":304,\"name\":\"hween09_floor_64_a_0_1\",\"z\":33.675612736942995,\"color\":16777215,\"y\":189},{\"x\":200,\"name\":\"hween09_floor_64_a_0_0\",\"z\":33.67559737427899,\"color\":16777215,\"y\":189},{\"x\":48,\"name\":\"hween09_floor_64_a_0_2\",\"z\":33.675593533686985,\"color\":16777215,\"y\":210},{\"x\":240,\"name\":\"hween09_floor_64_b_0_0\",\"z\":33.60413342482609,\"color\":16777215,\"y\":157},{\"x\":112,\"name\":\"hween09_floor_64_b_0_0\",\"z\":33.60411806097809,\"color\":16777215,\"y\":157},{\"x\":264,\"name\":\"hween09_floor_64_a_0_3\",\"z\":32.261445345745955,\"color\":16777215,\"y\":222},{\"x\":8,\"name\":\"hween09_floor_64_a_0_0\",\"z\":32.26144150544996,\"color\":16777215,\"y\":221},{\"x\":112,\"name\":\"hween09_floor_64_a_0_1\",\"z\":32.261429983562955,\"color\":16777215,\"y\":221},{\"x\":304,\"name\":\"hween09_floor_64_b_0_1\",\"z\":32.18998138970706,\"color\":16777215,\"y\":190},{\"x\":176,\"name\":\"hween09_floor_64_b_0_0\",\"z\":32.189966027043056,\"color\":16777215,\"y\":189},{\"x\":48,\"name\":\"hween09_floor_64_b_0_2\",\"z\":32.189962186451055,\"color\":16777215,\"y\":189},{\"x\":304,\"name\":\"hween09_floor_64_a_0_2\",\"z\":30.847293312550924,\"color\":16777215,\"y\":274},{\"x\":176,\"name\":\"hween09_floor_64_a_0_1\",\"z\":30.847277953179926,\"color\":16777215,\"y\":253},{\"x\":48,\"name\":\"hween09_floor_64_a_0_1\",\"z\":30.847274108221924,\"color\":16777215,\"y\":253},{\"x\":240,\"name\":\"hween09_floor_64_b_0_3\",\"z\":30.775813998510024,\"color\":16777215,\"y\":221},{\"x\":-16,\"name\":\"hween09_floor_64_b_0_0\",\"z\":30.77581015821402,\"color\":16777215,\"y\":221},{\"x\":112,\"name\":\"hween09_floor_64_b_0_1\",\"z\":30.77579863632702,\"color\":16777215,\"y\":222},{\"x\":264,\"name\":\"hween09_floor_64_a_0_0\",\"z\":29.43312591125289,\"color\":16777215,\"y\":285},{\"x\":-16,\"name\":\"hween09_floor_64_a_0_1\",\"z\":29.433122075877893,\"color\":16777215,\"y\":285},{\"x\":136,\"name\":\"hween09_floor_64_a_0_0\",\"z\":29.433110557209893,\"color\":16777215,\"y\":285},{\"x\":304,\"name\":\"hween09_floor_64_b_0_2\",\"z\":29.36166196531499,\"color\":16777215,\"y\":253},{\"x\":-80,\"name\":\"hween09_floor_64_b_0_2\",\"z\":29.36165811776699,\"color\":16777215,\"y\":253},{\"x\":176,\"name\":\"hween09_floor_64_b_0_1\",\"z\":29.36164660594399,\"color\":16777215,\"y\":254},{\"x\":48,\"name\":\"hween09_floor_64_b_0_1\",\"z\":29.361642760985987,\"color\":16777215,\"y\":254},{\"x\":200,\"name\":\"hween09_floor_64_a_0_0\",\"z\":28.01895852220186,\"color\":16777215,\"y\":317},{\"x\":72,\"name\":\"hween09_floor_64_a_0_0\",\"z\":28.01895467979686,\"color\":16777215,\"y\":317},{\"x\":240,\"name\":\"hween09_floor_64_b_0_0\",\"z\":27.947494564016957,\"color\":16777215,\"y\":285},{\"x\":-16,\"name\":\"hween09_floor_64_b_0_1\",\"z\":27.94749072864196,\"color\":16777215,\"y\":286},{\"x\":112,\"name\":\"hween09_floor_64_b_0_0\",\"z\":27.947479209973956,\"color\":16777215,\"y\":285},{\"x\":-80,\"name\":\"hween09_floor_64_b_0_1\",\"z\":26.533338691709925,\"color\":16777215,\"y\":318},{\"x\":176,\"name\":\"hween09_floor_64_b_0_0\",\"z\":26.533327174965923,\"color\":16777215,\"y\":317},{\"x\":48,\"name\":\"hween09_floor_64_b_0_0\",\"z\":26.533323332560926,\"color\":16777215,\"y\":317},{\"x\":176,\"color\":16777215,\"y\":7,\"flipH\":true,\"name\":\"attic15_wall_64_a_4_0\",\"z\":9.558869492430933},{\"x\":241,\"name\":\"attic15_wall_64_a_4_0\",\"z\":9.271516209561117,\"color\":16777215,\"y\":13},{\"x\":239,\"color\":16777215,\"y\":48,\"flipH\":true,\"name\":\"poster4_64_a_2_0\",\"z\":9.12799825144069},{\"x\":189,\"name\":\"poster27_64_a_2_0\",\"z\":9.075562463289835,\"color\":16777215,\"y\":11},{\"x\":241,\"color\":16777215,\"y\":16,\"flipH\":true,\"name\":\"poster27_64_a_2_0\",\"z\":8.854606248025643},{\"x\":127,\"color\":16777215,\"y\":31,\"flipH\":true,\"name\":\"attic15_wall_64_a_4_0\",\"z\":8.476036490854224},{\"x\":161,\"name\":\"poster32_64_a_2_0\",\"z\":8.423581939945835,\"color\":16777215,\"y\":46},{\"x\":132,\"name\":\"poster27_64_a_2_0\",\"z\":7.8159582974943715,\"color\":16777215,\"y\":39},{\"x\":311,\"name\":\"attic15_wall_64_a_4_0\",\"z\":7.724787422785769,\"color\":16777215,\"y\":48},{\"x\":299,\"color\":16777215,\"y\":61,\"flipH\":true,\"name\":\"poster501_64_a_2_0\",\"z\":7.690302789383893},{\"x\":303,\"color\":16777215,\"y\":47,\"flipH\":true,\"name\":\"poster27_64_a_2_0\",\"z\":7.484646465580049},{\"x\":281,\"name\":\"post_it_64_a_4_0\",\"z\":7.445529295087707,\"color\":10289052,\"y\":60},{\"x\":58,\"color\":16777215,\"y\":66,\"flipH\":true,\"name\":\"attic15_wall_64_a_4_0\",\"z\":6.95151516086106},{\"x\":85,\"name\":\"poster2004_64_a_2_0\",\"z\":6.737589576824266,\"color\":16777215,\"y\":70},{\"x\":210,\"name\":\"wf_trg_enter_room_64_a_0_0\",\"z\":6.734721312789403,\"color\":16777215,\"y\":110},{\"x\":209,\"name\":\"wf_act_show_message_64_a_0_0\",\"z\":6.734721312752403,\"color\":16777215,\"y\":110},{\"x\":212,\"name\":\"CF_50_goldbar_64_a_0_0\",\"z\":6.734721312123403,\"color\":16777215,\"y\":120},{\"x\":214,\"name\":\"wf_trg_enter_room_64_b_0_0\",\"z\":6.734014206045216,\"color\":16777215,\"y\":131},{\"x\":212,\"name\":\"CF_50_goldbar_64_a_0_0\",\"z\":6.727453627843682,\"color\":16777215,\"y\":88},{\"x\":212,\"name\":\"CF_50_goldbar_64_a_0_0\",\"z\":6.724817309135507,\"color\":16777215,\"y\":76},{\"x\":212,\"name\":\"CF_50_goldbar_64_a_0_0\",\"z\":6.7221809860983335,\"color\":16777215,\"y\":64},{\"x\":212,\"name\":\"CF_50_goldbar_64_a_0_0\",\"z\":6.71954466702016,\"color\":16777215,\"y\":52},{\"x\":71,\"name\":\"poster27_64_a_2_0\",\"z\":6.468205492163961,\"color\":16777215,\"y\":70},{\"x\":207,\"name\":\"attic15_carpet_64_a_4_0\",\"z\":6.027699142724448,\"color\":16777215,\"y\":173},{\"x\":284,\"color\":16777215,\"y\":166,\"name\":\"hc_arab_teamk_64_sd_4_0\",\"z\":6.027676065405918,\"alpha\":48},{\"x\":229,\"color\":16777215,\"y\":106,\"flipH\":true,\"name\":\"xmas11_luxchair2_64_a_2_0\",\"z\":6.027645301612387},{\"x\":178,\"name\":\"xmas11_luxchair2_64_a_2_0\",\"z\":6.027637616321385,\"color\":16777215,\"y\":106},{\"x\":282,\"color\":16777215,\"y\":100,\"name\":\"ads_pib_64_sd_4_0\",\"z\":6.011359389702032,\"alpha\":48},{\"x\":268,\"color\":16777215,\"y\":120,\"flipH\":true,\"name\":\"xmas11_luxchair2_64_b_2_0\",\"z\":5.531963448037617},{\"x\":162,\"name\":\"xmas11_luxchair2_64_b_2_0\",\"z\":5.531955762746616,\"color\":16777215,\"y\":120},{\"x\":-12,\"color\":16777215,\"y\":101,\"flipH\":true,\"name\":\"attic15_wall_64_a_4_0\",\"z\":5.404786375528712},{\"x\":21,\"name\":\"poster27_64_a_2_0\",\"z\":5.3633992157689985,\"color\":16777215,\"y\":95},{\"x\":319,\"color\":16777215,\"y\":184,\"flipH\":true,\"name\":\"bonusrare16_7_64_sd_0_0\",\"z\":5.320600043276903,\"alpha\":48},{\"x\":274,\"name\":\"hc_arab_teamk_64_a_4_0\",\"z\":5.32056928418237,\"color\":16777215,\"y\":71},{\"x\":148,\"name\":\"CF_50_goldbar_64_a_0_0\",\"z\":5.320553925662369,\"color\":16777215,\"y\":152},{\"x\":148,\"name\":\"CF_50_goldbar_64_a_0_0\",\"z\":5.317917604031195,\"color\":16777215,\"y\":141},{\"x\":148,\"name\":\"CF_50_goldbar_64_a_0_0\",\"z\":5.315281282178022,\"color\":16777215,\"y\":129},{\"x\":148,\"name\":\"CF_50_goldbar_64_a_0_0\",\"z\":5.312644967021848,\"color\":16777215,\"y\":117},{\"x\":148,\"name\":\"CF_50_goldbar_64_a_0_0\",\"z\":5.310008641172675,\"color\":16777215,\"y\":105},{\"x\":148,\"name\":\"CF_50_goldbar_64_a_0_0\",\"z\":5.307372326978501,\"color\":16777215,\"y\":93},{\"x\":148,\"name\":\"CF_50_goldbar_64_a_0_0\",\"z\":5.304736006272327,\"color\":16777215,\"y\":81},{\"x\":282,\"name\":\"ads_pib_64_a_4_0\",\"z\":5.304252608441485,\"color\":16777215,\"y\":67},{\"x\":256,\"color\":16777215,\"blendMode\":\"add\",\"y\":33,\"name\":\"ads_pib_64_b_4_0\",\"z\":5.303545501697298},{\"x\":-37,\"color\":16777215,\"y\":113,\"flipH\":true,\"name\":\"attic15_wall_64_a_4_0\",\"z\":4.852271904721265},{\"x\":-1,\"name\":\"poster13_64_a_2_0\",\"z\":4.774708330500601,\"color\":16777215,\"y\":127},{\"x\":88,\"color\":16777215,\"y\":204,\"name\":\"country_fnc3_64_sd_0_0\",\"z\":4.613504829990885,\"alpha\":48},{\"x\":116,\"name\":\"CF_50_goldbar_64_a_0_0\",\"z\":4.6134740629413535,\"color\":16777215,\"y\":168},{\"x\":319,\"color\":16777215,\"y\":153,\"flipH\":true,\"name\":\"bonusrare16_7_64_c_0_0\",\"z\":4.612079048490982},{\"x\":116,\"name\":\"CF_50_goldbar_64_a_0_0\",\"z\":4.61083774970918,\"color\":16777215,\"y\":157},{\"x\":116,\"name\":\"CF_50_goldbar_64_a_0_0\",\"z\":4.6082014237860065,\"color\":16777215,\"y\":145},{\"x\":95,\"color\":16777215,\"y\":173,\"flipH\":true,\"name\":\"penguin_infected_64_sd_4_0\",\"z\":4.605667125101341,\"alpha\":48},{\"x\":116,\"name\":\"CF_50_goldbar_64_a_0_0\",\"z\":4.605565109406832,\"color\":16777215,\"y\":133},{\"x\":116,\"name\":\"CF_50_goldbar_64_a_0_0\",\"z\":4.6029287918826585,\"color\":16777215,\"y\":121},{\"x\":116,\"name\":\"CF_50_goldbar_64_a_0_0\",\"z\":4.600292472693486,\"color\":16777215,\"y\":109},{\"x\":116,\"name\":\"CF_50_goldbar_64_a_0_0\",\"z\":4.597656149027311,\"color\":16777215,\"y\":97},{\"x\":98,\"color\":16777215,\"y\":126,\"name\":\"valentines_lovelock7_64_sd_2_0\",\"z\":4.596903141244089,\"alpha\":48},{\"x\":-19,\"name\":\"poster27_64_a_2_0\",\"z\":4.479554194638228,\"color\":16777215,\"y\":115},{\"x\":56,\"color\":16777215,\"y\":211,\"name\":\"cine_popcorn_64_sd_2_0\",\"z\":3.9064288129678677,\"alpha\":48},{\"x\":123,\"color\":16777215,\"y\":207,\"name\":\"scifiport_64_sd_0_0\",\"z\":3.9064211300818683,\"alpha\":48},{\"x\":88,\"name\":\"country_fnc3_64_a_0_0\",\"z\":3.906398048767337,\"color\":16777215,\"y\":159},{\"x\":96,\"color\":16777215,\"y\":121,\"flipH\":true,\"name\":\"penguin_infected_64_a_4_12\",\"z\":3.8985603438777936},{\"x\":90,\"name\":\"valentines_lovelock7_64_a_2_1\",\"z\":3.8897963600205405,\"color\":16777215,\"y\":63},{\"x\":-48,\"name\":\"poster27_64_a_2_0\",\"z\":3.8388778860718342,\"color\":16777215,\"y\":130},{\"x\":125,\"name\":\"scifiport_64_a_0_0\",\"z\":3.835710451741214,\"color\":16777215,\"y\":160},{\"x\":131,\"name\":\"scifiport_64_b_0_0\",\"z\":3.8314678110910942,\"color\":12277196,\"y\":166},{\"x\":141,\"color\":16777215,\"blendMode\":\"add\",\"y\":178,\"name\":\"scifiport_64_c_0_0\",\"z\":3.4807428476595668},{\"x\":140,\"name\":\"scifiport_64_d_0_0\",\"z\":3.4765002070094475,\"color\":16777215,\"y\":178},{\"x\":-12,\"color\":16777215,\"y\":240,\"flipH\":true,\"name\":\"hc_crpt_64_a_0_0\",\"z\":3.1993758804413837},{\"x\":153,\"color\":16777215,\"y\":234,\"name\":\"country_fnc2_64_sd_0_0\",\"z\":3.199341278016852,\"alpha\":48},{\"x\":46,\"name\":\"cine_popcorn_64_a_2_0\",\"z\":3.1993220316703206,\"color\":16777215,\"y\":120},{\"x\":72,\"name\":\"cine_popcorn_64_b_2_1\",\"z\":3.198614924926134,\"color\":16777215,\"y\":164},{\"x\":61,\"color\":16777215,\"y\":142,\"name\":\"cine_popcorn_64_c_2_0\",\"z\":3.1979078181819474,\"alpha\":63},{\"x\":157,\"name\":\"scifiport_64_e_0_0\",\"z\":3.1964859216965746,\"color\":16777215,\"y\":176},{\"x\":163,\"name\":\"scifiport_64_f_0_0\",\"z\":3.192243281046456,\"color\":12277196,\"y\":182},{\"x\":-25,\"name\":\"attic15_window_64_a_2_0\",\"z\":2.492269099143836,\"color\":16777215,\"y\":58},{\"x\":10,\"name\":\"xmas11_luxsofa2_64_a_2_0\",\"z\":2.492246018236304,\"color\":16777215,\"y\":186},{\"x\":151,\"name\":\"country_fnc2_64_a_0_0\",\"z\":2.492234496756305,\"color\":16777215,\"y\":198},{\"x\":161,\"name\":\"penguin_glow_64_a_4_0\",\"z\":2.4851805567465157,\"color\":16777215,\"y\":157},{\"x\":153,\"color\":16777215,\"blendMode\":\"add\",\"y\":149,\"name\":\"penguin_glow_64_b_4_0\",\"z\":2.484473450002329},{\"x\":16,\"name\":\"xmas11_luxsofa2_64_d_2_0\",\"z\":1.9951499511731614,\"color\":16777215,\"y\":275},{\"x\":186,\"name\":\"country_fnc2_64_b_0_0\",\"z\":1.8551312869442251,\"color\":16777215,\"y\":216},{\"x\":216,\"color\":16777215,\"y\":268,\"name\":\"country_fnc3_64_sd_0_0\",\"z\":1.78518924086282,\"alpha\":48},{\"x\":101,\"color\":16777215,\"y\":202,\"flipH\":true,\"name\":\"xmas11_luxsofa2_64_a_2_0\",\"z\":1.7851546347012888},{\"x\":-23,\"name\":\"xmas11_luxsofa2_64_b_2_0\",\"z\":1.7844321303055704,\"color\":16777215,\"y\":204},{\"x\":-41,\"color\":16777215,\"y\":255,\"flipH\":true,\"name\":\"env_tree3_64_sd_4_0\",\"z\":1.7837757221772659,\"alpha\":48},{\"x\":188,\"name\":\"hologram_64_a_0_1\",\"z\":1.7781045393904997,\"color\":16777215,\"y\":204},{\"x\":212,\"color\":16777215,\"y\":220,\"name\":\"djesko_turntable_64_sd_0_0\",\"z\":1.7773515370092767,\"alpha\":48},{\"x\":201,\"name\":\"hologram_64_b_0_1\",\"z\":1.7766903258651265,\"color\":16777215,\"y\":178},{\"x\":200,\"name\":\"hologram_64_c_0_1\",\"z\":1.7752761123397534,\"color\":16777215,\"y\":177},{\"x\":191,\"color\":16777215,\"blendMode\":\"add\",\"y\":157,\"name\":\"hologram_64_d_0_1\",\"z\":1.7738618988143804},{\"x\":-28,\"name\":\"xmas11_luxsofa2_64_c_2_0\",\"z\":1.642303667324074,\"color\":16777215,\"y\":221},{\"x\":-59,\"color\":16777215,\"y\":112,\"flipH\":true,\"name\":\"env_tree3_64_a_4_0\",\"z\":1.2180902970800278},{\"x\":-45,\"color\":16777215,\"y\":160,\"flipH\":true,\"name\":\"env_tree3_64_b_4_0\",\"z\":1.2173831903358412},{\"x\":249,\"color\":16777215,\"y\":282,\"name\":\"country_fnc2_64_sd_0_0\",\"z\":1.0781132277248038,\"alpha\":48},{\"x\":197,\"color\":16777215,\"y\":282,\"name\":\"plant_rose_black_64_sd_0_0\",\"z\":1.0781055436178035,\"alpha\":48},{\"x\":-46,\"name\":\"bb_rnd_tele_64_a_0_0\",\"z\":1.078093977604272,\"color\":16777215,\"y\":252},{\"x\":216,\"name\":\"country_fnc3_64_a_0_0\",\"z\":1.0780824596392726,\"color\":16777215,\"y\":223},{\"x\":141,\"color\":16777215,\"y\":220,\"flipH\":true,\"name\":\"xmas11_luxsofa2_64_b_2_0\",\"z\":1.077340746770555},{\"x\":212,\"name\":\"djesko_turntable_64_a_0_0\",\"z\":1.070244755785729,\"color\":16777215,\"y\":202},{\"x\":218,\"name\":\"hc16_3_64_a_0_0\",\"z\":1.0657558905011362,\"color\":16777215,\"y\":176},{\"x\":67,\"color\":16777215,\"y\":229,\"name\":\"hween10_fog_64_a_0_9\",\"z\":1.0073679454796176,\"alpha\":200},{\"x\":170,\"color\":16777215,\"y\":237,\"flipH\":true,\"name\":\"xmas11_luxsofa2_64_c_2_0\",\"z\":0.9352122837890587},{\"x\":-44,\"color\":16777215,\"y\":111,\"flipH\":true,\"name\":\"env_tree3_64_c_4_0\",\"z\":0.7217013367610715},{\"x\":-32,\"color\":16777215,\"y\":126,\"flipH\":true,\"name\":\"env_tree3_64_d_4_0\",\"z\":0.720994230016885},{\"x\":103,\"color\":16777215,\"y\":245,\"name\":\"hween10_fog_64_a_0_12\",\"z\":0.5823967700235027,\"alpha\":200},{\"x\":40,\"color\":16777215,\"y\":247,\"name\":\"hween10_fog_64_a_0_12\",\"z\":0.581689663279316,\"alpha\":200},{\"x\":86,\"color\":16777215,\"y\":293,\"flipH\":true,\"name\":\"anc_c15_table_64_sd_0_0\",\"z\":0.3710256908867872,\"alpha\":48},{\"x\":247,\"name\":\"country_fnc2_64_a_0_0\",\"z\":0.3710064464642562,\"color\":16777215,\"y\":246},{\"x\":196,\"name\":\"plant_rose_black_64_a_0_0\",\"z\":0.3709987623942561,\"color\":16777215,\"y\":219},{\"x\":-6,\"name\":\"attic15_window_64_b_2_1\",\"z\":0.3702416488400069,\"color\":16777215,\"y\":84},{\"x\":-15,\"color\":16777215,\"blendMode\":\"add\",\"y\":68,\"name\":\"attic15_window_64_c_2_1\",\"z\":0.36953454209582054},{\"x\":291,\"color\":16777215,\"y\":268,\"name\":\"penguin_musketeer_64_sd_4_0\",\"z\":0.3639832750209985,\"alpha\":48},{\"x\":252,\"name\":\"redhologram_64_a_0_1\",\"z\":0.3639525121524671,\"color\":16777215,\"y\":236},{\"x\":262,\"name\":\"redhologram_64_b_0_7\",\"z\":0.362538298627094,\"color\":16777215,\"y\":209},{\"x\":261,\"name\":\"redhologram_64_c_0_7\",\"z\":0.36112408510172095,\"color\":16777215,\"y\":208},{\"x\":255,\"color\":16777215,\"blendMode\":\"add\",\"y\":189,\"name\":\"redhologram_64_d_0_1\",\"z\":0.3597098715763479},{\"x\":74,\"color\":16777215,\"y\":262,\"flipH\":true,\"name\":\"hween10_fog_64_a_0_11\",\"z\":0.22742916594185578,\"alpha\":200},{\"x\":282,\"name\":\"country_fnc2_64_b_0_0\",\"z\":-0.26609676334782323,\"color\":16777215,\"y\":264},{\"x\":312,\"color\":16777215,\"y\":316,\"name\":\"country_fnc3_64_sd_0_0\",\"z\":-0.33603881183422835,\"alpha\":48},{\"x\":-59,\"color\":16777215,\"y\":250,\"flipH\":true,\"name\":\"xmas11_luxsofa2_64_a_2_0\",\"z\":-0.3360657325567607},{\"x\":197,\"color\":16777215,\"y\":250,\"flipH\":true,\"name\":\"xmas11_luxsofa2_64_a_2_0\",\"z\":-0.33607725059576016},{\"x\":81,\"color\":16777215,\"y\":275,\"flipH\":true,\"name\":\"anc_c15_table_64_a_0_0\",\"z\":-0.3360810903737603},{\"x\":121,\"color\":16777215,\"y\":307,\"name\":\"drinks_64_sd_0_0\",\"z\":-0.33890807906733583,\"alpha\":48},{\"x\":103,\"name\":\"attic15_oillamp_64_a_2_0\",\"z\":-0.33893117051986704,\"color\":16777215,\"y\":253},{\"x\":111,\"name\":\"attic15_oillamp_64_b_2_1\",\"z\":-0.3396382772640536,\"color\":16777215,\"y\":270},{\"x\":83,\"color\":16777215,\"blendMode\":\"add\",\"y\":237,\"name\":\"attic15_oillamp_64_c_2_1\",\"z\":-0.3403453840082401},{\"x\":285,\"name\":\"penguin_musketeer_64_a_4_0\",\"z\":-0.34312350620254906,\"color\":16777215,\"y\":204},{\"x\":-60,\"name\":\"avatar_86\",\"z\":-0.35561595857183614,\"color\":16777215,\"y\":184},{\"x\":-27,\"color\":10158109,\"y\":245,\"flipH\":true,\"name\":\"h_std_ch_2022_2_0\",\"z\":-0.35601595857183616},{\"x\":-29,\"color\":3355443,\"y\":216,\"flipH\":true,\"name\":\"h_std_hr_203_2_0\",\"z\":-0.35651595857183616},{\"x\":-29,\"color\":3355443,\"y\":216,\"flipH\":true,\"name\":\"h_std_hrb_203_2_0\",\"z\":-0.35661595857183614},{\"x\":312,\"name\":\"country_fnc3_64_a_0_0\",\"z\":-1.043145593057776,\"color\":16777215,\"y\":271},{\"x\":-19,\"color\":16777215,\"y\":268,\"flipH\":true,\"name\":\"xmas11_luxsofa2_64_b_2_0\",\"z\":-1.043879620487495},{\"x\":237,\"color\":16777215,\"y\":268,\"flipH\":true,\"name\":\"xmas11_luxsofa2_64_b_2_0\",\"z\":-1.0438911385264942},{\"x\":112,\"color\":16777215,\"y\":290,\"flipH\":true,\"name\":\"anc_c15_table_64_b_0_0\",\"z\":-1.0438949783044944},{\"x\":121,\"name\":\"drinks_64_a_0_0\",\"z\":-1.0460148602908834,\"color\":16777215,\"y\":286},{\"x\":99,\"color\":16777215,\"y\":277,\"name\":\"hween10_fog_64_a_0_9\",\"z\":-1.1138754632214314,\"alpha\":200},{\"x\":10,\"color\":16777215,\"y\":285,\"flipH\":true,\"name\":\"xmas11_luxsofa2_64_c_2_0\",\"z\":-1.1860080834689908},{\"x\":266,\"color\":16777215,\"y\":285,\"flipH\":true,\"name\":\"xmas11_luxsofa2_64_c_2_0\",\"z\":-1.1860196015079905},{\"x\":135,\"color\":16777215,\"y\":290,\"name\":\"hween10_fog_64_a_0_6\",\"z\":-1.5388466386775463,\"alpha\":200},{\"x\":72,\"color\":16777215,\"y\":292,\"name\":\"hween10_fog_64_a_0_6\",\"z\":-1.5395537454217327,\"alpha\":200},{\"x\":288,\"color\":16777215,\"y\":272,\"name\":\"scifirocket_64_a_0_0\",\"z\":-1.7502292846047924,\"alpha\":204},{\"x\":25,\"color\":16777215,\"y\":281,\"flipH\":true,\"name\":\"hween_c16_endtable2_64_a_2_0\",\"z\":-1.7502331299327931},{\"x\":271,\"color\":16777215,\"blendMode\":\"add\",\"y\":256,\"name\":\"scifirocket_64_b_0_1\",\"z\":-1.750936391348979},{\"x\":285,\"name\":\"scifirocket_64_c_0_0\",\"z\":-1.7516434980931654,\"color\":5592405,\"y\":296},{\"x\":279,\"name\":\"scifirocket_64_d_0_0\",\"z\":-1.752350604837352,\"color\":16777215,\"y\":270},{\"x\":297,\"name\":\"scifirocket_64_e_0_6\",\"z\":-1.7530577115815387,\"color\":16777215,\"y\":262},{\"x\":109,\"color\":16777215,\"y\":310,\"flipH\":true,\"name\":\"hween10_fog_64_a_0_9\",\"z\":-1.893814242759193,\"alpha\":200},{\"x\":236,\"name\":\"xmas11_luxsofa2_64_a_6_0\",\"z\":-2.457312981997809,\"color\":16777215,\"y\":298},{\"x\":266,\"name\":\"xmas11_luxsofa2_64_d_6_0\",\"z\":-2.9544090490609514,\"color\":16777215,\"y\":319}],\"modifiers\" : {},\"filters\" : [],\"roomid\" : 74080747,\"status\" : 19,\"timestamp\" : 1490150428987,\"checksum\" : 13585 }";
        Gson gson = new Gson();
        Photo photo = gson.fromJson(json, Photo.class);

        // 320x320
        BufferedImage base = new BufferedImage(320, 320, BufferedImage.TYPE_INT_ARGB);
        Graphics2D g = base.createGraphics();
        g.setColor(Color.black);
        g.fillRect(0, 0, 320, 320);
        //Collections.sort(photo.sprites, Comparator.comparing(Sprite::getZ));

        Collections.sort(photo.sprites, new Comparator<Sprite>() {
            @Override
            public int compare(Sprite o1, Sprite o2) {
                return o1.z > o2.z ? -1 : (o1.z < o2.z) ? 1 : 0;
            }
        });

        for (Sprite sprite : photo.sprites)
        {
//            System.out.println("C:\\Users\\scott\\Documents\\Queednet\\test\\sprites\\" + sprite.name + ".png");
            File image = new File("C:\\Users\\scott\\Documents\\Queednet\\test\\sprites\\" + sprite.name + ".png");
            if (!image.exists()) { System.out.println(image.getAbsolutePath()); continue; }
            BufferedImage spriteImage = ImageIO.read(image);
            BufferedImage transparentImage = new BufferedImage(spriteImage.getWidth(), spriteImage.getHeight(), BufferedImage.TYPE_INT_ARGB);
            Graphics g2 = transparentImage.getGraphics();
            g2.drawImage(spriteImage, 0, 0, null);

            if (sprite.color != 0)
                recolor(transparentImage, new Color(sprite.color));

            if (sprite.flipH)
                transparentImage = createFlipped(transparentImage);

            System.out.println(sprite.getAlpha());

//            base = ApplyTransparency(base, transparentImage);

//            spriteImage = TransformGrayToTransparency(spriteImage);

            g.setComposite(AlphaComposite.getInstance(AlphaComposite.SRC_ATOP, sprite.getAlpha()));
            g.drawImage(makeColorTransparent(transparentImage, Color.white), sprite.x, sprite.y, null);
        }

        ImageIO.write(base, "png", new File("C:\\Users\\scott\\image.png"));
    }

    private static BufferedImage ApplyTransparency(BufferedImage image, Image mask)
    {
        BufferedImage dest = new BufferedImage(
                image.getWidth(), image.getHeight(),
                BufferedImage.TYPE_INT_ARGB);
        Graphics2D g2 = dest.createGraphics();
        g2.drawImage(image, 0, 0, null);
        AlphaComposite ac = AlphaComposite.getInstance(AlphaComposite.DST_IN, 1.0F);
        g2.setComposite(ac);
        g2.drawImage(mask, 0, 0, null);
        g2.dispose();
        return dest;
    }

    private static BufferedImage createFlipped(BufferedImage image)
    {
        AffineTransform at = new AffineTransform();
        at.concatenate(AffineTransform.getScaleInstance(1, -1));
        at.concatenate(AffineTransform.getTranslateInstance(0, -image.getHeight()));
        return createTransformed(image, at);
    }

    private static BufferedImage createTransformed(BufferedImage image, AffineTransform at)
    {
        BufferedImage newImage = new BufferedImage(
                image.getWidth(), image.getHeight(),
                BufferedImage.TYPE_INT_ARGB);
        Graphics2D g = newImage.createGraphics();
        g.transform(at);
        g.drawImage(image, 0, 0, null);
        g.dispose();
        return newImage;
    }

    public static Image makeColorTransparent(BufferedImage im, final Color color) {
        ImageFilter filter = new RGBImageFilter() {

            // the color we are looking for... Alpha bits are set to opaque
            public int markerRGB = color.getRGB() | 0xFF000000;

            public final int filterRGB(int x, int y, int rgb) {
                if ((rgb | 0xFF000000) == markerRGB) {
                    // Mark the alpha bits as zero - transparent
                    return 0x00FFFFFF & rgb;
                } else {
                    // nothing to do
                    return rgb;
                }
            }
        };

        ImageProducer ip = new FilteredImageSource(im.getSource(), filter);
        Image img = Toolkit.getDefaultToolkit().createImage(ip);
        return ImageToBufferedImage(img, img.getWidth(null), img.getHeight(null));
    }

    private static BufferedImage ImageToBufferedImage(Image image, int width, int height)
    {
        BufferedImage dest = new BufferedImage(
                width, height, BufferedImage.TYPE_INT_ARGB);
        Graphics2D g2 = dest.createGraphics();
        g2.drawImage(image, 0, 0, null);
        g2.dispose();
        return dest;
    }

    public static void recolor(BufferedImage image, Color maskColor) {
        for (int x = 0; x < image.getWidth(); x++) {
            for (int y = 0; y < image.getHeight(); y++) {
                int pixel = image.getRGB(x, y);
                if (pixel >> 24 != 0) {
                    Color color = new Color(pixel);
                    float red = color.getRed() / 255.0F * (maskColor.getRed() / 255.0F);
                    float green = color.getGreen() / 255.0F * (maskColor.getGreen() / 255.0F);
                    float blue = color.getBlue() / 255.0F * (maskColor.getBlue() / 255.0F);
                    float alpha = color.getAlpha() / 255.0F * (maskColor.getAlpha() / 255.0F);

                    color = new Color(red, green, blue, alpha);
                    int rgb = color.getRGB();
                    image.setRGB(x, y, rgb);
                }
            }
        }
    }
}
